---

title: rfml_localization

keywords: fastai
sidebar: home_sidebar

summary: "Focus on repository is the location of uncooperative wireless emitters in an indoor environment.  The challenge is that an indoor environment results in dynamic, random propagation of wireless signals.  An approach is to create a RF fingerprint or map of the environment using different RF measurements techniques. Relevant measurements techniques generate a range of data from IQ samples to correlation curves to time-delay estimates (TDE's) for  TDOA; multiple power readings for RSS; and multiple angle of arrival readings for AoA.  The theoretical performance bounds are generated, via CRLB, of empirically measured and derived channel limitations that exists in literature.  From same literature, a simulation model is created that generates the specified random RF channel environment. From these foundations, regression models, that learn from the data in predicting the location of detected emitters, can be tested and validated; some of which are presented here."
description: "Focus on repository is the location of uncooperative wireless emitters in an indoor environment.  The challenge is that an indoor environment results in dynamic, random propagation of wireless signals.  An approach is to create a RF fingerprint or map of the environment using different RF measurements techniques. Relevant measurements techniques generate a range of data from IQ samples to correlation curves to time-delay estimates (TDE's) for  TDOA; multiple power readings for RSS; and multiple angle of arrival readings for AoA.  The theoretical performance bounds are generated, via CRLB, of empirically measured and derived channel limitations that exists in literature.  From same literature, a simulation model is created that generates the specified random RF channel environment. From these foundations, regression models, that learn from the data in predicting the location of detected emitters, can be tested and validated; some of which are presented here."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Github (using notebooks)<ul>
<li>git clone</li>
<li>cd rfml_localization</li>
<li>jupyter lab </li>
</ul>
</li>
<li>Github (using pure python lib)<ul>
<li>git clone</li>
<li>cd rfml_localization/rfml_localization</li>
<li>python<ul>
<li>import rfml_localization</li>
</ul>
</li>
</ul>
</li>
<li>pip install<ul>
<li><strong>not done yet</strong> <del><code>pip install rfml_localization</code></del></li>
</ul>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The primary purpose of package is to use available optimization techniques with RF fingerprinting for indoor localization.  The package is written to enable the leveraging of <a href="https://scikit-learn.org/">Sci-Kit Learn</a>.  In addition, it enables the use of GLMnet - (see <a href="https://glmnet-python.readthedocs.io/en/latest/glmnet_vignette.html">Glmnet Vignette</a>). This package includes a simulation mode, <code>RFsimulation</code>, to generate a set of locations and associated synthetic measurements.  For optimization, the focus is on kernilzing data, see <a href="/rfml_localization/core#HFF_k_matrix"><code>HFF_k_matrix</code></a>, and then pairing with regression models (<a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html">Ridge</a>, <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Lasso.html">Lasso</a>, <a href="https://scikit-learn.org/stable/modules/generated/sklearn.neural_network.MLPRegressor.html">MLPregressor</a>, etc) within SKLearn or the Glmnet model.  The kernelized measurement parameters are tuned along with chosen model.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Manual-Optimization">Manual Optimization<a class="anchor-link" href="#Manual-Optimization"> </a></h3><p>To use, first step is create an `RFchannel instance.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">rfml_localization.RFsimulation</span> <span class="k">as</span> <span class="nn">RFsim</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1">#generate channel scenario using default channel parameters</span>
<span class="n">RFchannel_scenario1</span> <span class="o">=</span> <span class="n">RFsim</span><span class="o">.</span><span class="n">RFchannel</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The object's channel parameters are:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#print out object variables</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RFchannel_scenario1</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>maxSpreadT, PoissonInvLambda, Poissoninvlambda, PoissonGamma, Poissongamma, PathLossN, Xsigma, Wavelength, AoAsigma, </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After setting up the environment, create a sensor setup (Tx and Rx locations) and make 1000 observations of a Tx at random locations.  As methods are run on the object, additional variable are added.  This allows inspection of user-specified parameters and even methods run on object.  They are listed below.  Compare to previous cell.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#from channel scenario, generate locations for Tx and Rx and set of measurements</span>
<span class="n">RFchannel_scenario1</span><span class="o">.</span><span class="n">generate_RxTxlocations</span><span class="p">(</span><span class="n">n_rx</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">n_runs</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">rxtx_flag</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">#generate set of measurements</span>
<span class="n">RFchannel_scenario1</span><span class="o">.</span><span class="n">generate_Xmodel</span><span class="p">()</span>
<span class="c1">#print out object variables</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RFchannel_scenario1</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>maxSpreadT, PoissonInvLambda, Poissoninvlambda, PoissonGamma, Poissongamma, PathLossN, Xsigma, Wavelength, AoAsigma, n_runs, n_rx, areaWL, sensor_locs, rxtx_flag, grid_flag, seed_loc, rxtx_locs, ch_delay_flag, tdoa_flag, seed_tdoa, rxx_delay, ch_gain_flag, drss_flag, seed_rss, rxx_rssi, ch_angle_flag, daoa_flag, seed_aoa, rxx_aoa, seed_Xmodel, X_model, </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that a set of measurements are created, split for training and testing.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#take object&#39;s set of measurements and assign to X,y</span>
<span class="n">X</span><span class="o">=</span><span class="n">RFchannel_scenario1</span><span class="o">.</span><span class="n">X_model</span>  <span class="c1">#measurements/observations</span>
<span class="n">y</span><span class="o">=</span><span class="n">RFchannel_scenario1</span><span class="o">.</span><span class="n">rxtx_locs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1">#location of  Tx</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Shapes of training data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre> Shapes of training data:
 (6700, 27) (6700, 2)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="SKLearn-Regressor">SKLearn Regressor<a class="anchor-link" href="#SKLearn-Regressor"> </a></h4><p>After generating locations, import SKLearn models for regression.  Use the SKLearn-based kernel trick function, <a href="/rfml_localization/core#sklearn_kt_regressor"><code>sklearn_kt_regressor</code></a>, which wraps a specified SKLearn model and kernelized matrix into a single interface to enable use of SKLearn hyper-tuning tools.  The <a href="/rfml_localization/core#sklearn_kt_regressor"><code>sklearn_kt_regressor</code></a> inherits all the basic functionality of standard SKLearn model API.  The following sets up model, sets parameters, fits the model, and then predicts.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>


<span class="c1">#based on knowledge of measurement, can derive from class instance rather than manually entering</span>
<span class="c1">#variables (shape[1] of rxx_delay, rxx_rss, rxx_aoa, i.e., RFchannel_scenario1.rxx_delay.shape[1])</span>
<span class="n">num_meas_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span> 
<span class="c1">#tuning parameter for each kernel</span>
<span class="n">kernel_s0</span><span class="p">,</span> <span class="n">kernel_s1</span><span class="p">,</span> <span class="n">kernel_s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.13e-06</span><span class="p">,</span> <span class="mf">2.07e-03</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="c1">#set up the model</span>
<span class="n">skl_kt_model</span> <span class="o">=</span> <span class="n">sklearn_kt_regressor</span><span class="p">(</span><span class="n">skl_model</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">01</span><span class="p">),</span> <span class="n">skl_kernel</span> <span class="o">=</span> <span class="s1">&#39;rbf&#39;</span><span class="p">,</span> 
                                    <span class="n">n_kernels</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">kernel_s0</span> <span class="o">=</span> <span class="n">kernel_s0</span><span class="p">,</span> <span class="n">kernel_s1</span> <span class="o">=</span> <span class="n">kernel_s1</span><span class="p">,</span> 
                                    <span class="n">kernel_s2</span> <span class="o">=</span> <span class="n">kernel_s2</span><span class="p">,</span> <span class="n">n_meas_array</span><span class="o">=</span><span class="n">num_meas_array</span><span class="p">)</span>

<span class="c1">#set/get model parameters - showing methods inherited from SKLearn</span>
<span class="c1">#assign a model parameter</span>
<span class="n">skl_kt_model</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">skl_model__alpha</span> <span class="o">=</span> <span class="mf">1.83e-06</span><span class="p">)</span>
<span class="c1">#display model params</span>
<span class="nb">print</span><span class="p">(</span><span class="n">skl_kt_model</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;kernel_s0&#39;: 1.13e-06, &#39;kernel_s1&#39;: 0.00207, &#39;kernel_s2&#39;: 10.0, &#39;n_kernels&#39;: 3, &#39;n_meas_array&#39;: array([15,  6,  6]), &#39;skl_kernel&#39;: &#39;rbf&#39;, &#39;skl_model__alpha&#39;: 1.83e-06, &#39;skl_model__copy_X&#39;: True, &#39;skl_model__fit_intercept&#39;: True, &#39;skl_model__max_iter&#39;: None, &#39;skl_model__normalize&#39;: False, &#39;skl_model__random_state&#39;: None, &#39;skl_model__solver&#39;: &#39;auto&#39;, &#39;skl_model__tol&#39;: 0.001, &#39;skl_model&#39;: Ridge(alpha=1.83e-06)}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#fit the model</span>
<span class="n">skl_kt_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>sklearn_kt_regressor(kernel_s0=1.13e-06, kernel_s1=0.00207, kernel_s2=10.0,
                     n_kernels=3, n_meas_array=array([15,  6,  6]),
                     skl_kernel=&#39;rbf&#39;, skl_model=Ridge(alpha=1.83e-06))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#predict the model</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">skl_kt_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1">#error measurement</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average error for (x,y) location estimation is </span><span class="si">{:5.2g}</span><span class="s1"> meters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mse</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Average error for (x,y) location estimation is   9.9 meters
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="GLMnet-Regressor">GLMnet Regressor<a class="anchor-link" href="#GLMnet-Regressor"> </a></h4><p>The GLMnet regressor, <a href="/rfml_localization/core#glmnet_kt_regressor"><code>glmnet_kt_regressor</code></a>, is defined in such a way to follow the SKLearn API -- advantageous in leveraging large body of tools.  Below steps through setting up a model, fitting, and predicting.  Using same data and kernel settings as <code>skl_kt_regressor</code> example.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#use same training and testing set</span>
<span class="n">num_meas_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span> 
<span class="n">kernel_s0</span><span class="p">,</span> <span class="n">kernel_s1</span><span class="p">,</span> <span class="n">kernel_s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.13e-06</span><span class="p">,</span> <span class="mf">2.07e-03</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="c1">#glmnet_args={&#39;family&#39;: &#39;mgaussian&#39;, &#39;standardize&#39;: False}</span>
<span class="n">glmnet_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">family</span><span class="o">=</span> <span class="s1">&#39;mgaussian&#39;</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1">#set up the model</span>
<span class="n">glm_kt_model</span> <span class="o">=</span> <span class="n">glmnet_kt_regressor</span><span class="p">(</span><span class="n">glm_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lambdau</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">skl_kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">n_kernels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                 <span class="n">kernel_s0</span> <span class="o">=</span> <span class="n">kernel_s0</span><span class="p">,</span> <span class="n">kernel_s1</span> <span class="o">=</span> <span class="n">kernel_s1</span><span class="p">,</span> <span class="n">kernel_s2</span> <span class="o">=</span> <span class="n">kernel_s2</span><span class="p">,</span>
                 <span class="n">n_meas_array</span><span class="o">=</span><span class="n">num_meas_array</span><span class="p">,</span> <span class="n">glmnet_args</span><span class="o">=</span><span class="n">glmnet_args</span><span class="p">)</span>

<span class="c1">#fit the model</span>
<span class="n">glm_kt_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>glmnet_kt_regressor(glm_alpha=0,
                    glmnet_args={&#39;family&#39;: &#39;mgaussian&#39;, &#39;standardize&#39;: False},
                    kernel_s0=1.13e-06, kernel_s1=0.00207, kernel_s2=10.0,
                    lambdau=array([0.001]), n_kernels=3,
                    n_meas_array=array([15,  6,  6]), skl_kernel=&#39;rbf&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#predict the model</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">glm_kt_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1">#error measurement</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average error for (x,y) location estimation is </span><span class="si">{:5.2g}</span><span class="s1"> meters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mse</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Average error for (x,y) location estimation is    23 meters
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Hyperparameter-Optimization">Hyperparameter Optimization<a class="anchor-link" href="#Hyperparameter-Optimization"> </a></h3><p>Generally speaking, model and kernel parameters need to be tuned. Building on previous example, leverage SKLearn model tools to conduct hyperparameter tuning.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="SKLearn-Regressor">SKLearn Regressor<a class="anchor-link" href="#SKLearn-Regressor"> </a></h4><p>Using SKLearn models.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">loguniform</span><span class="p">,</span> <span class="n">uniform</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>

<span class="c1">#use loguniform to search uniformaly across orders of magnitude</span>
<span class="n">distributions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;skl_model__alpha&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-7</span><span class="p">,</span> <span class="mf">1.0e+0</span><span class="p">),</span>
        <span class="s1">&#39;kernel_s0&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-7</span><span class="p">,</span> <span class="mf">1.0e+1</span><span class="p">),</span>
        <span class="s1">&#39;kernel_s1&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.0e+1</span><span class="p">),</span> 
        <span class="s1">&#39;kernel_s2&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1.0e+2</span><span class="p">),</span>
        <span class="s1">&#39;skl_kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;laplacian&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">],</span>  <span class="c1"># categorical parameter</span>
    <span class="p">}</span>
<span class="c1">#create search model from base model</span>
<span class="n">skl_kt_model_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">skl_kt_model</span><span class="p">,</span> <span class="n">distributions</span><span class="p">,</span>
                                     <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span> 
                                     <span class="n">cv</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_iter</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#fit search model</span>
<span class="n">search_results</span> <span class="o">=</span> <span class="n">skl_kt_model_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">search_results</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Fitting 5 folds for each of 100 candidates, totalling 500 fits
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
[Parallel(n_jobs=1)]: Done 500 out of 500 | elapsed: 58.1min finished
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;kernel_s0&#39;: 0.0007094452596116463, &#39;kernel_s1&#39;: 0.032187896160191284, &#39;kernel_s2&#39;: 0.2663595286341815, &#39;skl_kernel&#39;: &#39;laplacian&#39;, &#39;skl_model__alpha&#39;: 0.0006763336535533695}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From search, set params for base model and validate against test data</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#set params based on search</span>
<span class="n">skl_kt_model</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">search_results</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>

<span class="c1">#fit model using best params ()</span>
<span class="n">skl_kt_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1">#predict and show error</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">skl_kt_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mse</span><span class="o">=</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average error for (x,y) location estimation is </span><span class="si">{:5.2g}</span><span class="s1"> meters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mse</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Average error for (x,y) location estimation is   5.1 meters
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="GLMnet-Regressor">GLMnet Regressor<a class="anchor-link" href="#GLMnet-Regressor"> </a></h4><p>Using GLMnet model.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">loguniform</span><span class="p">,</span> <span class="n">uniform</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>

<span class="c1">#use loguniform to search uniformally across orders of magnitude</span>
<span class="n">distributions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;lambdau&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-7</span><span class="p">,</span> <span class="mf">1.0e+0</span><span class="p">),</span>
        <span class="s1">&#39;kernel_s0&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-7</span><span class="p">,</span> <span class="mf">1.0e+1</span><span class="p">),</span>
        <span class="s1">&#39;kernel_s1&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.0e+1</span><span class="p">),</span> 
        <span class="s1">&#39;kernel_s2&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1.0e+2</span><span class="p">),</span>
        <span class="s1">&#39;skl_kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;laplacian&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">],</span>  <span class="c1"># categorical parameter</span>
    <span class="p">}</span>
<span class="c1">#create search model from base model</span>
<span class="c1">#glmnet_model uses single cpu, so increase number of jobs </span>
<span class="n">glm_kt_model_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">glm_kt_model</span><span class="p">,</span> <span class="n">distributions</span><span class="p">,</span>
                                     <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span> 
                                     <span class="n">cv</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">n_iter</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#fit search model</span>
<span class="n">search_results</span> <span class="o">=</span> <span class="n">glm_kt_model_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">search_results</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Fitting 5 folds for each of 100 candidates, totalling 500 fits
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[Parallel(n_jobs=6)]: Using backend LokyBackend with 6 concurrent workers.
[Parallel(n_jobs=6)]: Done  38 tasks      | elapsed:  7.8min
[Parallel(n_jobs=6)]: Done 188 tasks      | elapsed: 39.3min
[Parallel(n_jobs=6)]: Done 438 tasks      | elapsed: 102.3min
[Parallel(n_jobs=6)]: Done 500 out of 500 | elapsed: 115.8min finished
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;kernel_s0&#39;: 0.0003017344124394731, &#39;kernel_s1&#39;: 0.0015381828738127007, &#39;kernel_s2&#39;: 0.13428923755571717, &#39;lambdau&#39;: 1.1024263412692438e-07, &#39;skl_kernel&#39;: &#39;rbf&#39;}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#set params based on search</span>
<span class="n">glm_kt_model</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">search_results</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>

<span class="c1">#fit model using best params ()</span>
<span class="n">glm_kt_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1">#predict and show error</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">glm_kt_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mse</span><span class="o">=</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average error for (x,y) location estimation is </span><span class="si">{:5.2g}</span><span class="s1"> meters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mse</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Average error for (x,y) location estimation is   5.7 meters
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

